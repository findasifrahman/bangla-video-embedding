name: data-pipeline-workflow

on: 
  push:
  workflow_dispatch:
  schedule:
    - cron: '35 0 * * *' 
    
jobs:
    run-data-pipeline:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repo content
              uses: actions/checkout@v4
              with:
                token: ${{secrets.MY_GITHUB_TOKEN }}
                python-version: '3.8'
            - name: Set up Python
              uses: actions/setup-python@v5
              with:
                python-version: '3.9'
                cache: 'pip'
            - name: Install dependencies
              run: |
                python -m pip install --upgrade pip
                pip install -r requirements.txt
            - name: Run data pipeline
              env: 
                YT_API_KEY: ${{secrets.YT_API_KEY }}
              run: |
                python data_pipeline.py
            - name: Check for changes
              id: git-check
              run: |
                git config --global user.name "GitHub Actions"
                git config --global user.email "github-actions@github.com"
                git add .
                git diff --staged --quiet || echo "changes=true" >> $GITHUB_ENV
            - name: Commit and push if changes
              if: env.changes == 'true'
              run: |
                git commit -m "Updated video index"
                git push